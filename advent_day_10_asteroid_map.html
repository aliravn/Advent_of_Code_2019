<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head>

<body>
	<div id="output"></div>

<script>
    const mapGrid = ["..#..###....#####....###........#", ".##.##...#.#.......#......##....#", "#..#..##.#..###...##....#......##","..####...#..##...####.#.......#.#","...#.#.....##...#.####.#.###.#..#","#..#..##.#.#.####.#.###.#.##.....","#.##...##.....##.#......#.....##.",".#..##.##.#..#....#...#...#...##.",".#..#.....###.#..##.###.##.......",".##...#..#####.#.#......####.....","..##.#.#.#.###..#...#.#..##.#....",".....#....#....##.####....#......",".#..##.#.........#..#......###..#","#.##....#.#..#.#....#.###...#....",".##...##..#.#.#...###..#.#.#..###",".#..##..##...##...#.#.#...#..#.#.",".#..#..##.##...###.##.#......#...","...#.....###.....#....#..#....#..",".#...###..#......#.##.#...#.####.","....#.##...##.#...#........#.#...","..#.##....#..#.......##.##.....#.",".#.#....###.#.#.#.#.#............","#....####.##....#..###.##.#.#..#.","......##....#.#.#...#...#..#.....","...#.#..####.##.#.........###..##",".......#....#.##.......#.#.###...","...#..#.#.........#...###......#.",".#.##.#.#.#.#........#.#.##..#...",".......#.##.#...........#..#.#...",".####....##..#..##.#.##.##..##...",".#.#..###.#..#...#....#.###.#..#.","............#...#...#.......#.#..",".........###.#.....#..##..#.##..."];

	// function to translate puzzle input into coordinates of all asteroids
    translateMapIntoCoordinates = (grid) => {
		const coordinates = [];
		for (let i = 0; i < grid.length; i++) {
			const gridLine = grid[i];
			for (let j = 0; j < gridLine.length; j++) {
				if (gridLine[j] === "#") {
					coordinates.push([j,i]);
				}
			}
		}
		return coordinates;
	};
	const asteroids = translateMapIntoCoordinates(mapGrid);

	// calculate angle between 2 vectors, need coordinates as parameters
	getAngleBetweenPoints = (endPt1, connectingPt, endPt2) => {
		let x1 = endPt1[0] - connectingPt[0]; //Vector 1 - x
		let y1 = endPt1[1] - connectingPt[1]; //Vector 1 - y

		let x2 = endPt2[0] - connectingPt[0]; //Vector 2 - x
		let y2 = endPt2[1] - connectingPt[1]; //Vector 2 - y

		let angle = Math.atan2(y1, x1) - Math.atan2(y2, x2);
		angle = angle * 360 / (2*Math.PI);

		if(angle < 0) {
			angle += 360;
		}

		return angle;
	}


	// find all unique angles for all asteroids
	getListOfUniqueAnglesForEachAsteroidPair = (asteroids) => {
		let result = [];
		for (let j = 0; j < asteroids.length; j++) {
			let anglesForEachAsteroid = {};
			const asteroid = asteroids[j];
			for (let i = 0; i < asteroids.length; i++) {
				// check if it is the same asteroid, then no calc is needed
				if (i === j) { continue; }

				// first vector is pointing straight up and all angles are calculated from it
				const angle = getAngleBetweenPoints([asteroid[0], asteroid[1] + 10], asteroid, asteroids[i]);

				anglesForEachAsteroid[angle] = true;
			}
			result[j] = anglesForEachAsteroid;
		}
		return result;
	};
	const listOfAllAngles = getListOfUniqueAnglesForEachAsteroidPair(asteroids);

	const numberOfAsteroidsDetectedFromEachPoint = listOfAllAngles.map((entry) => Object.keys(entry).length);

	const maxAsteroidsDetected = Math.max(...numberOfAsteroidsDetectedFromEachPoint);
	document.getElementById('output').innerHTML = `Max detected asteroids: ${maxAsteroidsDetected}`;

	// get location of the asteroid, where to place the laser and the station
	const where = numberOfAsteroidsDetectedFromEachPoint.indexOf(maxAsteroidsDetected);
	const laserLocation = asteroids[where];
	console.log(`Laser should be placed at: (${laserLocation})` ); // coordinates of the station

// PART 2 STARTS HERE

// 1) sort all asteroids by 4 sectors based on their coordinates / done
// 2) inside the sector: 
// 		- calc COS to the station
//		- find matching COS
// 		- find which of matches is closer to the station (will be detected first)
//		- remove the matches that are far away
// 		- determine the number of asteroids in sector
// 3) determine in which sector the 200th asteroid will be (
//	  eg. if 1st sector doesn't have 200 detected asteroids, it will be cleaned first and we don't care in which order
// 4) sort the asteroids within selected sector by ascending(180-360)/descending(0-180) COS
// 5) find the one that matches the 200th position


// const laserLocation = asteroids[where];
// const laserLocation = [27,19];



</script>
</body>
</html>
