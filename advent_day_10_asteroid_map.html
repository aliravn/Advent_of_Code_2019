<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head>

<body>
	<div id="output"></div>

<script>
    const mapGrid = ["..#..###....#####....###........#",".##.##...#.#.......#......##....#","#..#..##.#..###...##....#......##","..####...#..##...####.#.......#.#","...#.#.....##...#.####.#.###.#..#","#..#..##.#.#.####.#.###.#.##.....","#.##...##.....##.#......#.....##.",".#..##.##.#..#....#...#...#...##.",".#..#.....###.#..##.###.##.......",".##...#..#####.#.#......####.....","..##.#.#.#.###..#...#.#..##.#....",".....#....#....##.####....#......",".#..##.#.........#..#......###..#","#.##....#.#..#.#....#.###...#....",".##...##..#.#.#...###..#.#.#..###",".#..##..##...##...#.#.#...#..#.#.",".#..#..##.##...###.##.#......#...","...#.....###.....#....#..#....#..",".#...###..#......#.##.#...#.####.","....#.##...##.#...#........#.#...","..#.##....#..#.......##.##.....#.",".#.#....###.#.#.#.#.#............","#....####.##....#..###.##.#.#..#.","......##....#.#.#...#...#..#.....","...#.#..####.##.#.........###..##",".......#....#.##.......#.#.###...","...#..#.#.........#...###......#.",".#.##.#.#.#.#........#.#.##..#...",".......#.##.#...........#..#.#...",".####....##..#..##.#.##.##..##...",".#.#..###.#..#...#....#.###.#..#.","............#...#...#.......#.#..",".........###.#.....#..##..#.##..."];

	// function to translate puzzle input into coordinates of all asteroids
    translateMapIntoCoordinates = (grid) => {
		const coordinates = [];
		for (let i = 0; i < grid.length; i++) {
			const gridLine = grid[i];
			for (let j = 0; j < gridLine.length; j++) {
				if (gridLine[j] === "#") {
					coordinates.push([j,i]);
				}
			}
		}
		return coordinates;
	};
	const asteroids = translateMapIntoCoordinates(mapGrid);
	//console.log(">>> asteroids >>> ", asteroids);

	// find all possible angles for all asteroids
	getCosinusForEachAsteroidPair = (asteroids) => {
		let result = [];
		for (let j = 0; j < asteroids.length; j++) {
			let anglesForEachAsteroid = [];
			const asteroid = asteroids[j];
			for (let i = 0; i < asteroids.length; i++) {
				// check if it is the same asteroid, then no calc is needed
				if (i === j) { continue; }
				const a = Math.sqrt(
					Math.pow((-1 - asteroid[0]), 2)
				);
				const b = Math.sqrt(
					Math.pow((asteroid[0] - asteroids[i][0]), 2) +
					Math.pow((asteroid[1] - asteroids[i][1]), 2)
				);
				const c = Math.sqrt(
					Math.pow((-1 - asteroids[i][0]), 2) +
					Math.pow((asteroid[1] - asteroids[i][1]), 2)
				);
				let cos = Number(((Math.pow(a, 2) + Math.pow(b, 2) - Math.pow(c, 2)) / (2 * a * b)).toFixed(4));

				// check if asteroids are on the same axis, but in different directions
				if (asteroid[1] > asteroids[i][1]) {
					cos = `a${cos}`;
				} else if (asteroid[1] < asteroids[i][1]) {
					cos = `b${cos}`;
				} else if (asteroid[0] > asteroids[i][0]) {
					cos = `c${cos}`;
				}else if (asteroid[0] < asteroids[i][0]) {
					cos = `d${cos}`;
				}
				anglesForEachAsteroid.push(cos);
			}
			result[j] = anglesForEachAsteroid;
		}
		return result;
	};
	const listOfAllAngles = getCosinusForEachAsteroidPair(asteroids);
	// console.log(listOfAllAngles);

	// find number of unique angles for each asteroid
	const countList = [];
	for (let i = 0; i < listOfAllAngles.length; i++) {
		const unique = listOfAllAngles[i].filter((v, i, a) => a.indexOf(v) === i);
		countList.push(unique.length);
	}
	// console.log(countList);

	// find the asteroid, that can detect max number of other asteroids
	const max = Math.max(...countList);
	document.getElementById('output').innerHTML = `Max detected asteroids: ${max}`;

	// get location of the asteroid, where to place the laser and the station
	const where = countList.indexOf(max);
	const laserLocation = asteroids[where];
	console.log(`Laser should be placed at: (${laserLocation})` ); // coordinates of the station

// PART 2 STARTS HERE

// 1) sort all asteroids by 4 sectors based on their coordinates / done
// 2) inside the sector: 
// 		- calc COS to the station
//		- find matching COS
// 		- find which of matches is closer to the station (will be detected first)
//		- remove the matches that are far away
// 		- determine the number of asteroids in sector
// 3) determine in which sector the 200th asteroid will be (
//	  eg. if 1st sector doesn't have 200 detected asteroids, it will be cleaned first and we don't care in which order
// 4) sort the asteroids within selected sector by ascending(180-360)/descending(0-180) COS
// 5) find the one that matches the 200th position


// const laserLocation = asteroids[where];
// const laserLocation = [27,19];
let s1=[], s2=[], s3=[], s4=[];

sortAsteroidsBySector = (asteroids, laserLocation) => {
	for(i=0; i < asteroids.length; i++) {
		if(asteroids[i] === laserLocation) {
			continue;
		}
		// sector 1
		if(asteroids[i][0] >= laserLocation[0] && asteroids[i][1] < laserLocation[1]) {
			s1.push(asteroids[i]);
			continue;
		};
		// sector 2
		if(asteroids[i][0] > laserLocation[0] && asteroids[i][1] >= laserLocation[1]) {
			s2.push(asteroids[i]);
			continue;
		};
		// sector 3
		if(asteroids[i][0] <= laserLocation[0] && asteroids[i][1] > laserLocation[1]) {
			s3.push(asteroids[i]);
			continue;
		};
		// sector 4
		if(asteroids[i][0] < laserLocation[0] && asteroids[i][1] <= laserLocation[1]) {
			s4.push(asteroids[i]);
			continue;
		};
	}
};

sortAsteroidsBySector(asteroids, laserLocation);

console.log(">>> total adteroids in sectors >>> ", s1.length + s2.length + s3.length + s4.length);


</script>
</body>
</html>
